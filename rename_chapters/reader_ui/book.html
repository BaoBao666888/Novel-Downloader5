<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Thông tin truyện</title>
  <script>
    (() => {
      const SETTINGS_KEY = "reader.ui.settings.v3";
      const THEME_KEY = "reader.ui.theme.cache.v1";
      const defaults = {
        fontFamily: "'Noto Serif', 'Palatino Linotype', 'Times New Roman', serif",
        fontSize: 21,
        lineHeight: 1.9,
        paragraphSpacing: 1.1,
        textAlign: "justify",
        panelTransparency: "clear",
        starStyle: "classic",
        backgroundMotion: "on",
      };
      const fallbackTheme = {
        effect: "stars",
        tokens: {
          bg: "#090a1a",
          bg2: "#111433",
          surface: "#11162d",
          surface_alt: "#151f42",
          text: "#eaf2ff",
          muted: "#8ca3d4",
          accent: "#77b8ff",
          glow: "#9fd0ff",
          particle: "#ffffff",
        },
      };
      const root = document.documentElement;
      root.classList.add("theme-booting");
      let settings = { ...defaults };
      let theme = fallbackTheme;
      try {
        const rawSettings = localStorage.getItem(SETTINGS_KEY);
        if (rawSettings) settings = { ...defaults, ...JSON.parse(rawSettings) };
      } catch {}
      try {
        const rawTheme = localStorage.getItem(THEME_KEY);
        if (rawTheme) {
          const parsed = JSON.parse(rawTheme);
          if (parsed && parsed.tokens) theme = parsed;
        }
      } catch {}
      for (const [key, value] of Object.entries(theme.tokens || {})) {
        root.style.setProperty(`--${String(key).split("_").join("-")}`, value);
      }
      root.style.setProperty("--reader-font-family", settings.fontFamily);
      root.style.setProperty("--reader-font-size", `${settings.fontSize}px`);
      root.style.setProperty("--reader-line-height", `${settings.lineHeight}`);
      root.style.setProperty("--reader-paragraph-spacing", `${settings.paragraphSpacing}em`);
      root.style.setProperty("--reader-text-align", settings.textAlign);
      const effects = ["effect-stars", "effect-sparkle", "effect-bubbles", "effect-leaves", "effect-snow"];
      const stars = ["star-style-classic", "star-style-dense", "star-style-bling"];
      const panelStyles = ["panel-style-clear", "panel-style-balanced", "panel-style-solid"];
      root.classList.remove(...effects, ...stars);
      root.classList.add(`effect-${theme.effect || "stars"}`);
      root.classList.add(`star-style-${settings.starStyle || "classic"}`);
      root.classList.remove(...panelStyles);
      root.classList.add(`panel-style-${settings.panelTransparency || "clear"}`);
      root.classList.toggle("effects-paused", (settings.backgroundMotion || "on") !== "on");
    })();
  </script>
  <link rel="stylesheet" href="./styles.css?v=20260214-r07">
</head>
<body data-page="book" class="mpa-body">
  <script>
    (() => {
      const root = document.documentElement;
      const body = document.body;
      const effects = ["effect-stars", "effect-sparkle", "effect-bubbles", "effect-leaves", "effect-snow"];
      const stars = ["star-style-classic", "star-style-dense", "star-style-bling"];
      const panelStyles = ["panel-style-clear", "panel-style-balanced", "panel-style-solid"];
      body.classList.remove(...effects, ...stars, ...panelStyles);
      for (const cls of [...effects, ...stars, ...panelStyles]) {
        if (root.classList.contains(cls)) body.classList.add(cls);
      }
      body.classList.toggle("effects-paused", root.classList.contains("effects-paused"));
      body.classList.toggle("effects-lite", root.classList.contains("effects-lite"));
      root.classList.remove("theme-booting");
    })();
  </script>

  <div id="fx-layer" aria-hidden="true"></div>

  <header class="topbar sticky-topbar">
    <div class="brand">
      <h1 id="app-title"></h1>
      <p id="app-subtitle"></p>
    </div>
    <nav class="nav-tabs" aria-label="Điều hướng trang">
      <a id="nav-library" class="tab-btn" href="/library"></a>
      <a id="nav-search" class="tab-btn" href="/search"></a>
    </nav>
    <div class="topbar-actions">
      <input id="search-input" type="search" autocomplete="off">
      <button id="btn-go-search" class="btn" type="button"></button>
      <button id="btn-clear-cache" class="btn" type="button"></button>
      <button id="btn-open-settings" class="btn" type="button"></button>
    </div>
  </header>

  <div id="status-inline" class="status-inline" role="status" aria-live="polite" aria-busy="false"></div>

  <main class="pages single-main two-col">
    <section class="panel book-meta-panel">
      <div class="panel-head">
        <h2 id="book-info-title"></h2>
        <div class="meta-actions">
          <button id="btn-open-reader-from-book" class="btn btn-small" type="button"></button>
          <button id="btn-open-book-names" class="btn btn-small" type="button"></button>
          <button id="btn-open-book-edit" class="btn btn-small" type="button"></button>
        </div>
      </div>

      <div id="book-empty" class="book-empty"></div>

      <div id="book-view-wrap" class="book-meta-wrap hidden">
        <div class="book-hero">
          <div class="cover-wrap">
            <img id="book-cover" alt="Ảnh bìa truyện">
            <div id="book-cover-fallback" class="cover-fallback">Không có ảnh bìa</div>
          </div>

          <div class="book-hero-info">
            <h3 id="book-title-display"></h3>
            <p id="book-subtitle"></p>
            <button id="btn-open-extra-link" class="btn btn-small" type="button"></button>
          </div>
        </div>

        <div class="book-view-grid">
          <div class="book-info-item"><div class="book-info-label" id="label-view-title"></div><div class="book-info-value" id="view-title"></div></div>
          <div class="book-info-item"><div class="book-info-label" id="label-view-title-vi"></div><div class="book-info-value" id="view-title-vi"></div></div>
          <div class="book-info-item"><div class="book-info-label" id="label-view-author"></div><div class="book-info-value" id="view-author"></div></div>
          <div class="book-info-item"><div class="book-info-label" id="label-view-author-vi"></div><div class="book-info-value" id="view-author-vi"></div></div>
          <div class="book-info-item"><div class="book-info-label" id="label-view-summary"></div><div class="book-info-value multiline" id="view-summary"></div></div>
          <div class="book-info-item"><div class="book-info-label" id="label-view-extra-link"></div><div class="book-info-value" id="view-extra-link"></div></div>
        </div>
      </div>
    </section>

    <section class="panel toc-panel">
      <div class="panel-head">
        <h2 id="toc-title"></h2>
        <div class="toc-head-actions">
          <button id="btn-toc-mode-raw" class="btn btn-small" type="button"></button>
          <button id="btn-toc-mode-trans" class="btn btn-small" type="button"></button>
          <button id="btn-translate-titles" class="btn btn-small" type="button"></button>
        </div>
      </div>
      <ul id="toc-list" class="simple-list"></ul>
      <div class="toc-footer">
        <button id="btn-toc-prev" class="btn btn-small" type="button"></button>
        <button id="btn-toc-next" class="btn btn-small" type="button"></button>
      </div>
    </section>
  </main>

  <dialog id="book-edit-dialog" class="dialog name-editor-dialog">
    <div class="dialog-head">
      <h3 id="book-edit-title"></h3>
      <button id="btn-close-book-edit" class="btn btn-small" type="button"></button>
    </div>
    <form id="book-meta-form" class="meta-form">
      <label><span id="label-field-title"></span><input id="field-title" type="text"></label>
      <label><span id="label-field-title-vi"></span><input id="field-title-vi" type="text"></label>
      <label><span id="label-field-author"></span><input id="field-author" type="text"></label>
      <label><span id="label-field-author-vi"></span><input id="field-author-vi" type="text"></label>
      <label><span id="label-field-summary"></span><textarea id="field-summary" rows="5"></textarea></label>
      <label><span id="label-field-extra-link"></span><input id="field-extra-link" type="url"></label>
      <div class="cover-actions">
        <label><span id="label-field-cover-url"></span><input id="field-cover-url" type="url"></label>
        <div class="cover-btns">
          <input id="cover-upload-input" type="file" accept="image/*" hidden>
          <button id="btn-upload-cover" class="btn btn-small" type="button"></button>
          <button id="btn-apply-cover-url" class="btn btn-small" type="button"></button>
        </div>
      </div>
      <div class="meta-actions"><button id="btn-save-meta" class="btn btn-primary" type="submit"></button></div>
    </form>
  </dialog>

  <dialog id="book-name-dialog" class="dialog name-editor-dialog">
    <div class="dialog-head">
      <h3 id="book-name-title"></h3>
      <button id="btn-close-book-names" class="btn btn-small" type="button"></button>
    </div>
    <div class="name-editor-head">
      <label>
        <span id="book-name-set-label"></span>
        <select id="book-name-set-select"></select>
      </label>
      <div class="name-set-actions">
        <button id="btn-book-name-refresh" class="btn btn-small" type="button"></button>
        <button id="btn-book-name-add-set" class="btn btn-small" type="button"></button>
        <button id="btn-book-name-del-set" class="btn btn-small" type="button"></button>
        <button id="btn-book-name-export" class="btn btn-small" type="button"></button>
        <input id="book-name-import-file" type="file" accept=".json,application/json" hidden>
        <button id="btn-book-name-import" class="btn btn-small" type="button"></button>
      </div>
      <p id="book-name-count" class="empty-text"></p>
    </div>
    <form id="book-name-entry-form" class="name-entry-form">
      <label><span id="book-name-source-label">Tên gốc</span><input id="book-name-source" type="text" required></label>
      <label><span id="book-name-target-label">Tên dịch</span><input id="book-name-target" type="text" required></label>
      <button id="btn-book-name-save-entry" class="btn btn-primary" type="submit"></button>
    </form>
    <div class="name-preview-wrap">
      <div class="name-preview-table-wrap">
        <table class="name-preview-table">
          <thead><tr><th>Tên gốc</th><th>Tên dịch</th><th>Thao tác</th></tr></thead>
          <tbody id="book-name-body"></tbody>
        </table>
      </div>
    </div>
  </dialog>

  <aside id="settings-drawer" class="settings-drawer" aria-hidden="true">
    <div class="settings-head">
      <h3 id="settings-title"></h3>
      <button id="btn-close-settings" class="btn btn-small" type="button"></button>
    </div>
    <form id="settings-form" class="settings-form">
      <label><span id="label-theme"></span><select id="theme-select"></select></label>
      <label><span id="label-panel-transparency"></span><select id="panel-transparency-select"><option id="panel-clear" value="clear"></option><option id="panel-balanced" value="balanced"></option><option id="panel-solid" value="solid"></option></select></label>
      <label><span id="label-font-family"></span><select id="font-family-select"></select></label>
      <label><span id="label-star-style"></span><select id="star-style-select"><option id="star-style-classic" value="classic"></option><option id="star-style-dense" value="dense"></option><option id="star-style-bling" value="bling"></option></select></label>
      <label><span id="label-background-motion"></span><select id="background-motion-select"><option id="motion-on" value="on"></option><option id="motion-off" value="off"></option></select></label>
      <label><span id="label-font-size"></span><input id="font-size-input" type="range" min="15" max="36" step="1"><small id="font-size-value"></small></label>
      <label><span id="label-text-align"></span><select id="text-align-select"><option id="align-justify" value="justify">Đều hai bên</option><option id="align-left" value="left">Canh trái</option><option id="align-center" value="center">Canh giữa</option></select></label>
      <label><span id="label-line-height"></span><input id="line-height-input" type="range" min="1.2" max="2.6" step="0.05"><small id="line-height-value"></small></label>
      <label><span id="label-paragraph-spacing"></span><input id="paragraph-spacing-input" type="range" min="0.2" max="2.2" step="0.05"><small id="paragraph-spacing-value"></small></label>
      <label><span id="label-reading-mode"></span><select id="reading-mode-select"><option id="mode-flip" value="flip"></option><option id="mode-horizontal" value="horizontal"></option><option id="mode-vertical" value="vertical"></option><option id="mode-hybrid" value="hybrid"></option></select></label>
      <label><span id="label-mini-bars-enabled"></span><select id="mini-bars-enabled-select"><option id="mini-bars-on" value="on"></option><option id="mini-bars-off" value="off"></option></select></label>
      <div class="settings-actions"><button id="btn-save-settings" class="btn btn-primary" type="submit"></button><button id="btn-reset-settings" class="btn" type="button"></button></div>
    </form>
  </aside>
  <div id="settings-backdrop" class="settings-backdrop" hidden></div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script type="module" src="./js/pages/book_page.js?v=20260215-vb01"></script>
</body>
</html>
